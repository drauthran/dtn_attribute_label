<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="action_report_dtn_attribute_label_new" model="ir.actions.report">
            <field name="name">Этикетка с атрибутами (58х40)</field>
            <field name="model">product.product</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">dtn_attribute_label.report_template_dtn_custom</field>
            <field name="report_file">dtn_attribute_label.report_template_dtn_custom</field>
            <field name="binding_model_id" ref="product.model_product_product"/>
            <field name="paperformat_id" ref="dtn_attribute_label.paperformat_label_40x58_dymo_override"/>
        </record>

        <template id="report_template_dtn_custom">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="doc">
                    <div t-attf-style="width:58mm; height:40mm; background:#FFF; color:#000; padding: 0 1mm; margin:0; box-sizing:border-box; font-family: 'Arial', sans-serif; display: flex; flex-direction: column; justify-content: flex-start; overflow: hidden; {{ 'page-break-before: always;' if not doc_first else '' }}">

                        <t t-if="doc.x_reliable_active and doc.x_reliable_name">
                            <div style="text-align: center; font-weight: bold; font-size: 10pt; width: 100%; margin-bottom: 2mm; flex-shrink: 0; line-height: 1.2; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">
                                <t t-esc="doc.x_reliable_name"/>
                            </div>

                            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 2mm; flex-shrink: 0;">
                                <div style="font-size: 16pt; font-weight: bold;">
                                    <t t-esc="'{:.0f}'.format(doc.x_reliable_lst_price)"/> <t t-esc="doc.x_reliable_currency_symbol"/>
                                </div>
                                <div style="width: 26mm; text-align: left;">
                                    <t t-if="doc.x_reliable_barcode">
                                        <img t-att-src="'/report/barcode/?barcode_type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('EAN13', doc.x_reliable_barcode, 300, 50)" style="max-width: 100%; height: auto;" alt="Barcode"/>
                                        <div style="font-size: 7pt;"><t t-esc="doc.x_reliable_barcode"/></div>
                                    </t>
                                </div>
                            </div>
                            
                            <div style="width: 100%; text-align: left; font-size: 7pt; flex-grow: 1; overflow: hidden; display: flex;">
                                <t t-set="grouped_attributes" t-value="doc.get_grouped_attributes()"/>
                                <t t-set="midpoint" t-value="(len(grouped_attributes) + 1) // 2"/>

                                <div style="width: 50%; padding-right: 2mm;">
                                    <t t-foreach="grouped_attributes[:midpoint]" t-as="attr_tuple">
                                        <div style="padding-bottom: 1px;">
                                            <span><t t-esc="attr_tuple[0]"/>:</span> <t t-esc="attr_tuple[1]"/>
                                        </div>
                                    </t>
                                </div>
                                <div style="width: 50%; padding-left: 2mm;">
                                     <t t-foreach="grouped_attributes[midpoint:]" t-as="attr_tuple">
                                        <div style="padding-bottom: 1px;">
                                            <span><t t-esc="attr_tuple[0]"/>:</span> <t t-esc="attr_tuple[1]"/>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <t t-else="">
                            <div style="text-align:center; padding: 5px; color: red; width: 100%;">
                                <span>Товар недоступен</span><br/>
                                <span>ID: <t t-esc="doc.id or 'N/A'"/></span><br/>
                                <t t-if="not doc.x_reliable_active"><span>(Неактивен)</span></t>
                            </div>
                        </t>

                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>